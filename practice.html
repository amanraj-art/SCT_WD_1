<!--
Modern Calculator
Single-file HTML/CSS/JS
Features:
- Basic arithmetic (+ - × ÷)
- Percentage, square root, +/- toggle
- Decimal points
- Clear (C), All Clear (AC), Backspace
- Keyboard support (numbers, + - * / Enter = Backspace, Esc)
- Responsive layout
- Copy result button

Use this file: save as calculator.html and open in a browser.
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Modern Calculator</title>
  <style>
    :root{
      --bg:#0f1724; /* navy */
      --panel:#0b1220;
      --accent:#06b6d4; /* cyan */
      --btn:#111827;
      --muted:#94a3b8;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, #071029 0%, #071b2b 100%);
      color:#e6eef6;
      padding:24px;
    }
    .calculator{
      width:360px;
      max-width:96vw;
      background:linear-gradient(180deg,var(--panel), rgba(255,255,255,0.02));
      border-radius:16px;
      padding:18px;
      box-shadow:0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }
    .display{
      background:rgba(255,255,255,0.02);
      border-radius:10px;
      padding:18px;
      min-height:64px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-end;
      gap:6px;
      margin-bottom:12px;
      overflow:hidden;
    }
    .display .expr{color:var(--muted); font-size:14px; word-break:break-all}
    .display .out{font-size:28px; font-weight:600}
    .keys{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }
    button{
      border:0;
      background:var(--btn);
      color:inherit;
      padding:14px 10px;
      border-radius:10px;
      font-size:18px;
      box-shadow:0 6px 12px rgba(2,6,23,0.5);
      cursor:pointer;
      user-select:none;
    }
    button:active{transform:translateY(1px)}
    .op{background:linear-gradient(180deg, rgba(6,182,212,0.14), rgba(6,182,212,0.06)); border:1px solid rgba(6,182,212,0.12); color:var(--accent);}
    .wide{grid-column:span 2}
    .accent{background:linear-gradient(180deg,#06b6d4,#0284c7); color:#06202a; font-weight:700}
    .muted{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted)}
    .note{font-size:12px; color:var(--muted); margin-top:8px; text-align:center}
    @media (max-width:420px){
      .display .out{font-size:24px}
      button{padding:12px 8px}
    }
  </style>
</head>
<body>
  <div class="calculator" role="application" aria-label="Calculator">
    <div class="display" id="display">
      <div class="expr" id="expr" aria-hidden="true">&nbsp;</div>
      <div class="out" id="output">0</div>
    </div>

    <div class="keys">
      <button class="muted" data-action="allclear">AC</button>
      <button class="muted" data-action="clear">C</button>
      <button class="muted" data-action="back">⌫</button>
      <button class="op" data-value="/">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="op" data-value="*">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="op" data-value="-">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="op" data-value="+">+</button>

      <button data-action="plusminus">±</button>
      <button data-value="0">0</button>
      <button data-value=".">.</button>
      <button class="accent" data-action="equals">=</button>

      <button class="wide muted" data-action="percent">% (percent)</button>
      <button class="wide muted" data-action="sqrt">√ (sqrt)</button>
    </div>

    <div class="note">Tip: Use keyboard — numbers, + - * /, Enter for =, Backspace to delete, Esc for AC. | <button id="copyBtn" class="muted" style="padding:6px 10px; margin-left:6px; font-size:12px">Copy</button></div>
  </div>

  <script>
    (function(){
      const exprEl = document.getElementById('expr');
      const outEl = document.getElementById('output');
      const copyBtn = document.getElementById('copyBtn');

      let expr = ''; // raw expression using JS operators (*, /)
      let lastResult = null;

      function render(){
        exprEl.textContent = expr || '\u00A0';
        outEl.textContent = expr ? exprToDisplay(expr) : '0';
      }

      function exprToDisplay(e){
        // show human-friendly operators
        return e.replace(/\*/g,'×').replace(/\//g,'÷');
      }

      function appendValue(v){
        // prevent multiple dots in a number
        if (v === '.'){
          // find last token after operator
          const parts = expr.split(/(?=[+\-*/])|(?<=[+\-*/])/);
          const last = parts[parts.length-1] || '';
          if (last.includes('.')) return;
          if (last === '' || /[+\-*/]/.test(last)) v = '0.';
        }
        expr += v;
        render();
      }

      function doBack(){
        expr = expr.slice(0,-1);
        render();
      }

      function doClear(){ expr = ''; render(); }
      function doAllClear(){ expr = ''; lastResult = null; render(); }

      function doPlusMinus(){
        // toggle sign of last number
        if (!expr) return;
        // find last number token
        const m = expr.match(/([+\-*/])?([0-9.]+)$/);
        if (!m) return;
        const sign = m[1] || '';
        let number = m[2];
        // if sign is '-', remove it; if not, insert '-'
        const start = m.index || 0;
        if (sign === '-'){
          expr = expr.slice(0,start) + ('' ) + number; // remove sign
        } else if (sign === '+'){
          expr = expr.slice(0,start) + '-' + number;
        } else {
          expr = expr.slice(0,start) + '-' + number;
        }
        render();
      }

      function doPercent(){
        // convert last number to its percent (divide by 100)
        if (!expr) return;
        const m = expr.match(/([+\-*/])?([0-9.]+)$/);
        if (!m) return;
        const start = m.index || 0;
        const number = parseFloat(m[2]);
        if (isNaN(number)) return;
        const replaced = (number/100).toString();
        expr = expr.slice(0,start) + replaced;
        render();
      }

      function doSqrt(){
        // apply sqrt to whole expression or last number if present
        if (!expr) return;
        try{
          const val = evaluateExpression(expr);
          if (val < 0) { alert('Square root of negative number'); return; }
          expr = String(Math.sqrt(val));
          lastResult = expr;
          render();
        }catch(e){ alert('Invalid expression'); }
      }

      function evaluateExpression(e){
        // safe-ish evaluator: reject letters
        if (/[a-zA-Z]/.test(e)) throw new Error('Invalid');
        // prevent consecutive operators like ++ or ** (except unary -)
        // replace accidental × ÷ if present
        e = e.replace(/×/g,'*').replace(/÷/g,'/');
        // strip leading zeros in numbers? not necessary
        // Use Function constructor to evaluate
        // Limit length to avoid abuse
        if (e.length > 200) throw new Error('Too long');
        const fn = new Function('return ' + e);
        const result = fn();
        if (typeof result !== 'number' || !isFinite(result)) throw new Error('Bad result');
        // round small floating errors
        return Math.round(result * 1e12)/1e12;
      }

      function doEquals(){
        if (!expr) return;
        try{
          const val = evaluateExpression(expr);
          lastResult = String(val);
          expr = lastResult;
          render();
        }catch(e){ alert('Invalid expression'); }
      }

      document.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.getAttribute('data-value');
          const a = btn.getAttribute('data-action');
          if (v) appendValue(v);
          else if (a){
            if (a === 'back') doBack();
            else if (a === 'clear') doClear();
            else if (a === 'allclear') doAllClear();
            else if (a === 'equals') doEquals();
            else if (a === 'percent') doPercent();
            else if (a === 'sqrt') doSqrt();
            else if (a === 'plusminus') doPlusMinus();
          }
        });
      });

      // keyboard support
      window.addEventListener('keydown', (ev)=>{
        const k = ev.key;
        if (/^[0-9]$/.test(k)) { appendValue(k); ev.preventDefault(); }
        else if (k === '.') appendValue('.');
        else if (k === 'Enter' || k === '=') { doEquals(); ev.preventDefault(); }
        else if (k === 'Backspace') { doBack(); ev.preventDefault(); }
        else if (k === 'Escape') { doAllClear(); ev.preventDefault(); }
        else if (k === '+'|| k === '-'|| k === '*'|| k === '/') { appendValue(k); ev.preventDefault(); }
      });

      copyBtn.addEventListener('click', ()=>{
        navigator.clipboard && navigator.clipboard.writeText(outEl.textContent).then(()=>{
          const prev = copyBtn.textContent;
          copyBtn.textContent = 'Copied!';
          setTimeout(()=> copyBtn.textContent = prev, 1200);
        }).catch(()=>{ alert('Copy failed'); });
      });

      // init
      render();
    })();
  </script>
</body>
</html>
